generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ServiceCategory {
  funeral
  grooming
  custom_vehicles
  other_care
}

enum ReservationStatus {
  PENDING
  CONFIRMED
  CANCELED
  COMPLETED
}

//
// ========== MODELS ==========
//

model User {
  user_id      String   @id @default(uuid()) @db.Uuid
  email        String   @unique
  name         String
  phone        String?
  profileImage String?
  address      String?
  latitude     Float?   // ğŸ‘ˆ ì¶”ê°€: ìœ„ë„
  longitude    Float?
  role         String
  createdAt    DateTime @default(now())

  // Relations
  pets                  Pet[]
  services              Service[]              @relation("UserServices")        // ì‚¬ì—…ìê°€ ë“±ë¡í•œ ì„œë¹„ìŠ¤ë“¤
  reservations          Reservation[]          @relation("UserReservations")    // ì˜ˆì•½í•œ ìœ ì €ë¡œì„œì˜ ì˜ˆì•½
  businessReservations  Reservation[]          @relation("BusinessReservations")// ì‚¬ì—…ìë¡œì„œ ë°›ì€ ì˜ˆì•½
  notifications         Notification[]         @relation("UserNotifications")   // ìœ ì €ì˜ ì•Œë¦¼ë“¤
   businessAvailableTime  BusinessAvailableTime[] @relation("BusinessAvailableTime")
}

model Pet {
  pet_id     String   @id @default(uuid()) @db.Uuid
  user_id    String   @db.Uuid
  name       String
  species    String
  breed      String?
  age        Int?
  weight     Float?
  photo      String?
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  // Relations
  user         User         @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
  reservations Reservation[]
}

model Service {
  service_id   String   @id @default(uuid()) @db.Uuid
  admin_id     String   @db.Uuid
  name         String
  description  String
  price        Decimal
  category     ServiceCategory
  created_at   DateTime  @default(now())
  updated_at   DateTime  @updatedAt

  // Relations
  admin     User          @relation("UserServices", fields: [admin_id], references: [user_id])
  reservations Reservation[]

  @@map("services")
}

model BusinessAvailableTime {
  id           String   @id @default(uuid())
  business_id      String   @db.Uuid       // ì‚¬ì—…ì ID
  day_of_week  String                 // 'mon', 'tue', ...
  start_time   String                 // '09:00'
  end_time     String                 // '18:00'
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  business     User     @relation("BusinessAvailableTime", fields: [business_id], references: [user_id])
}

model Reservation {
  reservation_id   String   @id @default(uuid()) @db.Uuid 
  user_id          String   @db.Uuid              // ì˜ˆì•½ì
  service_id       String   @db.Uuid              // ì–´ë–¤ ì„œë¹„ìŠ¤
  business_id      String   @db.Uuid              // ë§¤ì¹­ëœ ì‚¬ì—…ì
  pet_id           String   @db.Uuid              // ë°˜ë ¤ë™ë¬¼
  reserved_at      DateTime                       // ì˜ˆì•½ ì¼ì‹œ (ì˜ˆ: 2025-04-01T10:00:00Z)
  status           ReservationStatus              // ì˜ˆì•½ ìƒíƒœ
  notes            String?                        // ìš”ì²­ì‚¬í•­
  price            Decimal     @default(0)

  created_at       DateTime    @default(now())
  updated_at       DateTime    @updatedAt

  // Relations
  user       User     @relation("UserReservations", fields: [user_id], references: [user_id], onDelete: Cascade)
  business   User     @relation("BusinessReservations", fields: [business_id], references: [user_id], onDelete: Cascade)
  service    Service  @relation(fields: [service_id], references: [service_id], onDelete: Cascade)
  pet        Pet      @relation(fields: [pet_id], references: [pet_id], onDelete: Cascade)

  @@map("reservations")
}


model Notification {
  notification_id String   @id @default(uuid()) @db.Uuid
  user_id         String   @db.Uuid
  message         String
  type            String   // 'reservation', 'system', 'etc'
  is_read         Boolean  @default(false)
  created_at      DateTime @default(now())
  user            User     @relation("UserNotifications", fields: [user_id], references: [user_id], onDelete: Cascade)

  @@map("notifications") // ì‹¤ì œ í…Œì´ë¸”ëª…
}
